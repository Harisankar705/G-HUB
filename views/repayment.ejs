
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>G-HUB</title>

<meta name="author" content="Untree.co">
<!-- <link rel="shortcut icon" href="favicon.png"> -->
<meta name="description" content="" />
<meta name="keywords" content="bootstrap, bootstrap4" />

<!-- Bootstrap CSS -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
<link href="../assets/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<link href="../assets/css/tiny-slider.css" rel="stylesheet">
<link href="../assets/css/stylee.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" /><body>
  <link href="../assets/css/slick.css">
  <link href="../assets/css/slick-theme.css">
  <link href="../assets/css/nouislider.min.css">
  <link href="../assets/css/checkout.css">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<!-- Start Header/Navigation -->
<nav class="custom-navbar navbar navbar-expand-md navbar-dark bg-dark" aria-label="Furni navigation bar">
  <a href="#" onclick="goBack()"><img src="../public/back-button-removebg-preview.png" id="back-button"></a>

    <div class="container">
    <a class="navbar-brand" href="#">G-HUB<span>.</span></a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsFurni" aria-controls="navbarsFurni" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarsFurni">
        <ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/home">Shop</a>
        </li>
        <!-- <li class="nav-item">
            <a class="nav-link" href="shop.html">Shop</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="about.html">About us</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="contact.html">Contact us</a>
        </li> -->
        </ul>

        <ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 ms-5">
          <li><a class="nav-link" href="/userprofile/<%= user._id %>"><i class="fa fa-user"></i></a></li>
          <li><a class="nav-link" href="/cart"><i class="fa fa-shopping-cart"></i></a></li>
          <li><a class="nav-link" href="/wishlist"><i class="fa fa-heart" aria-hidden="true"></i></a></li>
          <li><a class="nav-link" href="/userWallet/<%=user._id%>"><i class="fa-solid fa-wallet"></i></a></li>
          <li><a class="nav-link" href=""><i></i></a></li>
<form action="/logout" method="POST">
  <button type="submit" class="nav-link" style="border: none; background: none; cursor: pointer;">
    <i class="fa fa-sign-out"></i>
  </button>
</form>
      </ul>
    </div>
    </div>
</nav>
<body>
<div id="breadcrumb" class="section">
  <div class="container">
    <div class="row">
    </div>
  </div>
</div>
<div class="section">
  <div class="container">
    <div class="row">

      <div class="col-md-7">
        <div class="shiping-details">
          <div class="section-title">
            <h3 class="title">Shiping address</h3>
            
          </div>
          <div class="form-group">
            
          </div>
          <div class="row">
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-body">
                        <div>
                            <p class="card-text">Name: <%= order.addresstoDeliver.username %></p>
                            <p class="card-text">Mobile Number: <%= order.addresstoDeliver.phonenumber %></p>
                            <p class="card-text">Address: <%= order.addresstoDeliver.houseaddress %></p>
                            <p class="card-text">District: <%= order.addresstoDeliver.district %></p>
                            <p class="card-text">City: <%= order.addresstoDeliver.city %></p>
                            <p class="card-text">State: <%= order.addresstoDeliver.state %></p>
                            <p class="card-text">PIN Code: <%= order.addresstoDeliver.pincode %></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
          
                  

        </div>
       
      <div class="modal fade" id="addCouponModal" tabindex="-1" aria-labelledby="exampleModalLabel"
      aria-hidden="true">
    
    
  </div>
      
        
      </div>
  <div class="col-md-5 order-details">
  <div class="section-title text-center">
    <h3 class="title">Your Order</h3>
  </div>
  <ul class="list">
  <li><a href="">Product <span>Total1</span></a></li>
  <% if (products.length> 0) { %>
    <% products.forEach((product)=> { %>
      <li><a href=""><%- product.productId.name %><span class="middle">x <%-
        product.quantity %></span>
    <span class="last"> &#x20B9; <%-
                product.total.toFixed() %></span></a>
      </li>
      <% }) %>
        <% } %>

</ul>
<ul class="list list_2">
  <li><a href="">Delivery Charges <span id="deliveryCharges">
        &#x20B9;<%-deliveryCharges %> </span></a></li>
</ul>
<ul class="list list_2">
  <li><a href="">Total <span id="total">
        &#x20B9;<%- grandTotal.toFixed() %> </span></a></li>
</ul>


<ul class="list list_2">
  <li><a href="">Coupon Discount in %<span id="couponDiscount">
    <%=couponDiscountPercentage%>
              </span></a></li>
</ul>


<ul class="list list_2">
  <li><a href="" class="text-success">Grand Total <span class="text-success"
        id="cartTotal" data-cartTotal="<%- grandTotal %>">
        â‚¹<%- (grandTotal).toFixed() %></span></a></li>
</ul>

<div class="payment-method">
  <div class="input-radio">
    <input type="radio" name="payment" id="payment-1">
    <label for="payment-1">
      <span></span>
      Cash On Delivery
    </label>

  </div>
</div>
  <div class="payment-method">
    <div class="input-radio">
      <input type="radio" name="payment" id="payment-2">
      <label for="razorpay">
        <span></span>
        RazorPay
      </label>
    </div>
  </div>
  <a href="#" class="primary-btn order-submit" id="place-order">Place order</a>
</div>
</div>
</div>
</div>

<style>
  /* Add these styles to your existing styles or style tags */
.form-group {
margin-top: 20px;
display: flex;
}

label {
margin-right: 10px;
}

#couponCode {
padding: 8px;
border: 1px solid #ccc;
border-radius: 5px;
margin-right: 10px;
}

#applyCoupon {
padding: 8px 12px;
background-color: #007bff;
color: #fff;
border: none;
border-radius: 5px;
cursor: pointer;
}

#applyCoupon:hover {
background-color: #0056b3;
}

    #back-button {
width: 30px;
}
#footer {
background-color: #333;
color: #fff;
padding: 30px 0;
}

#footer .footer {
margin-bottom: 30px;
}

#footer .footer-title {
font-size: 18px;
color: #fff;
margin-bottom: 15px;
}

#footer .footer-links {
list-style: none;
padding: 0;
}

#footer .footer-links li {
margin-bottom: 10px;
}

#footer .footer-links a {
color: #fff;
text-decoration: none;
}

/* Place Order Button Styles */
#place-order {
background-color: #45a049;
color: #fff;
padding: 10px 20px;
border-radius: 4px;
text-decoration: none;
display: inline-block;
transition: background-color 0.3s ease;
width: 450px;
text-align: center;
}

#place-order:hover {
background-color: #357d3a;
}

.order-details {
background-color: #f9f9f9;
padding: 20px;
border-radius: 8px; 
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.section-title {
margin-bottom: 20px;
}

.list {
list-style: none;
padding: 0;
}

.list li {
padding: 10px 0;
border-bottom: 1px solid #ddd;
}

.list a {
color: #333;
text-decoration: none;
display: flex;
justify-content: space-between;
}

.payment_item {
margin-top: 20px;
}

.payment_radio {
display: flex;
align-items: center;
margin-bottom: 10px;
}

.payment_radio input {
margin-right: 10px;
}

.payment-method {
margin-top: 20px;
}

.payment-method .input-radio {
margin-bottom: 15px;
}

.caption {
display: none;
margin-top: 10px;
color: #666;
}

.input-checkbox {
margin-top: 20px;
}

.order-submit {
display: inline-block;
padding: 10px 20px;
color: #fff;
text-decoration: none;
border-radius: 4px;
transition: background-color 0.3s ease;
}

.order-submit:hover {
background-color: #45a049;
}

</style>
<script>

function goBack()
{
  window.history.back()
}




document.getElementById('place-order').addEventListener('click', async (event) => {
event.preventDefault();


const productElements = document.querySelectorAll('.list li');
const products = [];

productElements.forEach((productElement) => {
const productNameElement = productElement.querySelector('a');
const productName = productNameElement ? productNameElement.textContent.trim() : '';

const quantityElement = productElement.querySelector('.middle');
const quantityText = quantityElement ? quantityElement.textContent.trim().split('x')[1] : '0';
const quantity = quantityElement ? parseInt(quantityElement.textContent.trim().split('x')[1].trim(), 10) : 0;

const totalElement = productElement.querySelector('.last');
const total = totalElement ? parseInt(totalElement.textContent.trim().replace('â‚¹', ''), 10) : 0;


products.push({ productName, quantity, total });
});

const radioButtons = document.getElementsByName('address-option');
let selectedRadioButton = null;

for (const radioButton of radioButtons) {
if (radioButton.checked) {
  selectedRadioButton = radioButton.value;
  console.log('Selected Address ID:', selectedRadioButton); // Add this line for debugging
  break;
}
}

const paymentMethodRadio1 = document.getElementById('payment-1');
const paymentMethodRadio2=document.getElementById('payment-2')


let paymentMethod;
if
(!paymentMethodRadio1.checked && !paymentMethodRadio2.checked)
{
Swal.fire({icon:'error',message:"Payment not selected",text:"Please select any of the payment methods"})
return
}
paymentMethod = paymentMethodRadio1.checked ? 'Cash On Delivery' : "Razorpay"; // Set the value based on the selected payment method
const isCashOnDeliverySelected = paymentMethodRadio1.checked ? 'Cash On Delivery'   :"Razorpay"
const couponDiscountPercentage=document.getElementById('couponDiscount').innerHTML
const deliveryCharges=document.getElementById('deliveryCharges').innerHTML
const couponDiscount=parseFloat(couponDiscountPercentage)
console.log("COOPONDICOU",couponDiscount);
const orderId="<%=order.id%>"
const grandTotal = "<%= grandTotal %>"; 
const amountInPaise = (grandTotal * 100).toFixed();
// This assumes grandTotal is passed from the server
if(paymentMethod==="Cash On Delivery" && grandTotal>1000)
{
  Swal.fire({
    icon:"error",
    title:"Payment not available",
    text:"COD is available for above 1000"
  })
}

if (paymentMethod === "Razorpay") {
    initiatePayment();
}


function initiatePayment() {
    var options = {
        "key": "rzp_test_wSI5EPnj247nka",
        "amount": amountInPaise, // Convert amount to paise
        "currency": 'INR',
        "name": 'G-HUB',
        "description": 'Transaction',
        "handler": function(response) {
            if (response.razorpay_payment_id) {
                fetch(`/repayment/${orderId}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ paymentMethod: paymentMethod, grandTotal: grandTotal })
                })
              
                Swal.fire({
              title: "Paid succesfully!",
              icon: "success",
              showConfirmButton: false
            });
            setTimeout(() => {
              window.location.href = '/userorders';
            }, 2000);
              
            } else {
                fetch('/orderfailed', {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ paymentMethod: paymentMethod, grandTotal: grandTotal })
                })
                .then(response => response.json())
                .then(data => {
                    window.location.href = "/userorders";
                })
                .catch(error => {
                    console.error('Error:', error);
                    window.location.href = "/userorders";
                });
            }
        }
    };

    var rzp = new Razorpay(options);

    rzp.on('payment.error', function(response) {
  console.log("Payment failed", response);
  setTimeout(() => {
    Swal.fire({
      icon: "error",
      title: "Payment failed",
      text: "Payment failed to continue the payment from my orders"
    }).then(() => {
      window.location.href = '/userorders';
    });
  }, 4000);
});

    rzp.open();
}
})










</script>
<script src="../assets/js/vendors/jquery-3.6.0.min.js"></script>
<script src="../assets/js/vendors/bootstrap.min.js"></script>
</body>
</html>
